{% extends "base.html" %}
{% load humanize %}

{% block content %}

<div class="container">

  <h2 class="mb-4">{{ request.user.username }} ë‹˜ì˜ ëŒ€ì‹œë³´ë“œ</h2>

  <div class="row g-4">

    <!-- ì´ë²ˆë‹¬ í†µê³„ -->
    <div class="col-12 col-lg-4">
      <div class="card shadow-sm p-3">

        <h5 class="fw-bold mb-3">ğŸ“Š ì´ë²ˆë‹¬ ìš”ì•½</h5>

        <p class="mb-1">ì´ ìˆ˜ì…:
          <strong class="text-primary">{{ month_income|intcomma }}</strong> ì›
        </p>

        <p class="mb-1">ì´ ì§€ì¶œ:
          <strong class="text-danger">{{ month_spending|intcomma }}</strong> ì›
        </p>

        <p class="mb-3">
          ì°¨ì•¡:
          <strong class="{% if month_diff < 0 %}text-danger{% else %}text-success{% endif %}">
            {{ month_diff|intcomma }}
          </strong> ì›
        </p>

        <a href="{% url 'analysis:analysis_create_html' %}" class="btn btn-dark btn-sm w-100">
          ğŸ” ì´ë²ˆë‹¬ ë¶„ì„í•˜ê¸°
        </a>

      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½: ìµœê·¼ ê±°ë˜ -->
    <div class="col-12 col-lg-8">

      <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="fw-bold mb-0">ğŸ“ ìµœê·¼ ê±°ë˜</h5>
        <a href="{% url 'transactions:transaction_create' %}" class="btn btn-dark btn-sm">+ ìƒˆ ê±°ë˜</a>
      </div>

      {% if recent_transactions %}
        <ul class="list-group">
          {% for t in recent_transactions %}
            <li class="list-group-item border-0 border-bottom py-2 px-0">
              <a href="{% url 'transactions:transaction_detail' t.id %}"
                 class="d-block text-decoration-none text-body">

                <div class="d-flex justify-content-between">
                  <div class="fw-semibold">
                    {{ t.get_category_display }}
                    {% if t.memo %} Â· {{ t.memo }}{% endif %}
                  </div>
                  <div class="fw-bold {% if t.type == 'withdraw' %}text-danger{% else %}text-primary{% endif %}">
                    {% if t.type == "withdraw" %}-{% else %}+{% endif %}
                    {{ t.amount|intcomma }}ì›
                  </div>
                </div>

                <div class="text-muted small d-flex justify-content-between mt-1">
                  <span>{{ t.transacted_at|date:"Y-m-d H:i" }}</span>
                  <span>{{ t.account.nickname|default:t.account }}</span>
                </div>

              </a>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="text-muted">ìµœê·¼ ê±°ë˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
      {% endif %}

      <div class="text-center mt-3">
        <a href="{% url 'transactions:transaction_html' %}" class="btn btn-outline-secondary btn-sm">
          ì „ì²´ ê±°ë˜ ë³´ê¸°
        </a>
      </div>

    </div>

  </div>

</div>

{% endblock %}
