{% extends "base.html" %}
{% load humanize %}

{% block content %}

<!-- í•„í„°ê¸°ëŠ¥ ì¶”ê°€ -->
<div class="card shadow-sm p-3 mb-4">
  <form method="GET" class="row g-3">

    <!-- ì¹´í…Œê³ ë¦¬ -->
    <div class="col-md-3">
      <label class="form-label fw-semibold">ì¹´í…Œê³ ë¦¬</label>
      <select name="category" class="form-select">
        <option value="">ì „ì²´</option>
        <option value="food" {% if request.GET.category == "food" %}selected{% endif %}>ì‹ë¹„</option>
        <option value="transport" {% if request.GET.category == "transport" %}selected{% endif %}>êµí†µ</option>
        <option value="shopping" {% if request.GET.category == "shopping" %}selected{% endif %}>ì‡¼í•‘</option>
        <option value="income" {% if request.GET.category == "income" %}selected{% endif %}>ìˆ˜ì…</option>
        <option value="etc" {% if request.GET.category == "etc" %}selected{% endif %}>ê¸°íƒ€</option>
      </select>
    </div>

    <!-- ì‹œì‘ ë‚ ì§œ -->
    <div class="col-md-3">
      <label class="form-label fw-semibold">ì‹œì‘ ë‚ ì§œ</label>
      <input type="date"
             name="start"
             class="form-control"
             value="{{ request.GET.start }}">
    </div>

    <!-- ì¢…ë£Œ ë‚ ì§œ -->
    <div class="col-md-3">
      <label class="form-label fw-semibold">ì¢…ë£Œ ë‚ ì§œ</label>
      <input type="date"
             name="end"
             class="form-control"
             value="{{ request.GET.end }}">
    </div>

    <!-- ë²„íŠ¼ -->
    <div class="col-md-3 d-flex align-items-end">
      <button class="btn btn-dark w-100 py-2">
        ğŸ” í•„í„° ì ìš©
      </button>
    </div>

  </form>
</div>

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="mb-0">{{ request.user.username }} ë‹˜ì˜ ê°€ê³„ë¶€</h2>
    <a href="{% url 'transactions:transaction_create' %}" class="btn btn-dark btn-sm">
      + ìƒˆ ê±°ë˜
    </a>
  </div>

  {% if transactions %}
    <div class="table-responsive">
      <table class="table table-sm table-hover table-striped align-middle">
        <thead class="table-light text-center">
          <tr>
            <th scope="col">ë‚ ì§œ</th>
            <th scope="col">ë‚´ìš©</th>
            <th scope="col">ê¸ˆì•¡</th>
            <th scope="col">ë¶„ë¥˜</th>
            <th scope="col">ìì„¸íˆ</th>
          </tr>
        </thead>
        <tbody class="text-center">
          {% for t in transactions %}
            <tr>
              <td>{{ t.transacted_at|date:"Y-m-d H:i" }}</td>
              <td>{{ t.memo|default:"(ë©”ëª¨ ì—†ìŒ)" }}</td>
              <td class="text-center">
                {% if t.type == "withdraw" %}
                  <span class="text-danger fw-semibold">
                    -{{ t.amount|intcomma }}ì›
                  </span>
                {% else %}
                  <span class="text-primary fw-semibold">
                    +{{ t.amount|intcomma }}ì›
                  </span>
                {% endif %}
              </td>
              <td>{{ t.get_category_display }}</td>
              <td>
                <a href="{% url 'transactions:transaction_detail' t.id %}"
                   class="btn btn-sm btn-outline-secondary">
                  ìì„¸íˆ
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-muted">ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endif %}
{% endblock %}

{% block js %}
  {% include 'form-js.html' %}
{% endblock %}
